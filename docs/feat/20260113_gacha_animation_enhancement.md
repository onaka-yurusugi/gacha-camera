# ガチャ演出強化 設計書

## 概要

召喚演出を大幅に改修し、より豪華でゲームらしい体験を提供する。

## 要件

### 1. 待機画面（召喚前）
- **現状**: シンプルな「タップで召喚」ボタンのみ
- **改修後**: ゲーム風の豪華な扉とクリスタルを常時表示
  - 金色の豪華な扉
  - 中央に光るクリスタル
  - 脈動アニメーションで「触れたくなる」演出

### 2. タップ時の演出
- **現状**: フラッシュ → ローリング → エフェクト
- **改修後**: クリスタル破砕演出
  1. クリスタルが光り輝く
  2. 破砕エフェクト（光の粒子が飛び散る）
  3. その後既存のローリング演出へ

### 3. 名前カットイン演出
- **現状**: 左からスライドインするシンプルなカットイン
- **改修後**: ズームイン＋震動の「ドカーン」演出
  1. 画面いっぱいにズーム
  2. 画面が揺れるインパクト
  3. 名前がドカーンと登場

### 4. セリフ表示位置
- **現状**: 画面中央〜やや下
- **改修後**: 画面下部に固定（顔が隠れないように）

### 5. SSR演出強化
- **現状**: 虹色エフェクト＋光の粒子
- **改修後**: よりド派手に
  - 画面全体が揺れる
  - 複数回のフラッシュ
  - 光の爆発エフェクト
  - 金色のオーラ追加
  - パーティクル大量発生

## 演出フロー（改修後）

```
[待機状態]
  扉＋クリスタル表示（脈動アニメーション）
       ↓ タップ
[破砕フェーズ]
  クリスタル発光 → 破砕 → 光の粒子飛散
       ↓
[ローリングフェーズ]
  既存のスピナー演出
       ↓
[エフェクトフェーズ]
  レアリティに応じた背景エフェクト
  ※SSRはド派手に
       ↓
[レアリティ表示フェーズ]
  バッジ表示
       ↓
[名前カットインフェーズ] ★強化
  ズームイン＋震動
  名前がドカーンと登場
       ↓
[セリフフェーズ] ★位置変更
  画面下部に表示
       ↓
[フェードアウト]
```

## 技術的アプローチ

### 新規コンポーネント

1. **SummonGate.tsx** - 扉とクリスタルの待機画面
   - CSS/SVGで豪華な扉をデザイン
   - クリスタルの脈動アニメーション
   - framer-motionでインタラクション

2. **CrystalShatter.tsx** - クリスタル破砕演出
   - 破片がランダムな方向に飛び散る
   - 光の粒子エフェクト

3. **SSRExplosion.tsx** - SSR専用ド派手エフェクト
   - 複数フラッシュ
   - 画面揺れ
   - 金色オーラ
   - 大量パーティクル

### 既存コンポーネント修正

1. **CharacterCutin.tsx**
   - ズームイン＋震動アニメーション追加
   - よりインパクトのある登場演出

2. **SerifDisplay.tsx**
   - 位置を画面下部に変更
   - 必要に応じてデザイン調整

3. **GachaOverlay.tsx**
   - 新しいフェーズ追加（shatter）
   - SSR用の特別演出分岐

4. **TapToSummon.tsx** → **SummonGate.tsx** に置き換え
   - または内部で扉を表示するよう改修

## ファイル変更一覧

| ファイル | 変更種別 | 内容 |
|---------|---------|------|
| src/components/Gacha/SummonGate.tsx | 新規 | 扉＋クリスタル表示 |
| src/components/Gacha/CrystalShatter.tsx | 新規 | 破砕エフェクト |
| src/components/Gacha/SSRExplosion.tsx | 新規 | SSR専用エフェクト |
| src/components/Gacha/CharacterCutin.tsx | 修正 | ズーム＋震動演出 |
| src/components/Gacha/SerifDisplay.tsx | 修正 | 位置を下部に変更 |
| src/components/Gacha/GachaOverlay.tsx | 修正 | 新フェーズ追加 |
| src/components/Gacha/RainbowEffect.tsx | 修正 | SSR演出強化 |
| src/components/UI/TapToSummon.tsx | 修正/削除 | SummonGateに置き換え |
| src/app/page.tsx | 修正 | コンポーネント差し替え |

## 検証方法

1. `npm run dev` で開発サーバー起動
2. 各レアリティ（N/R/SR/SSR）で演出を確認
3. 特にSSRの演出が十分にド派手か確認
4. セリフが顔を隠さないか確認
5. `npm run build` でビルドエラーがないか確認

## 実装完了 (2026-01-13)

全ての改修が完了し、ビルドも成功。

### 実装内容

1. **SummonGate.tsx** - ソシャゲ風の金色の扉とクリスタル
   - 両開きの豪華な金色の扉
   - 中央に脈動するクリスタル
   - 周囲にスパークルエフェクト
   - 浮遊するパーティクル

2. **CrystalShatter.tsx** - クリスタル破砕演出
   - レアリティに応じた色の破片
   - 中央からのフラッシュ
   - リングウェーブエフェクト
   - SSR時は虹色バースト追加

3. **SSRExplosion.tsx** - SSR専用ド派手エフェクト
   - 複数回のフラッシュ
   - 画面揺れ
   - 金色オーラ
   - 50個以上のパーティクル
   - スターバースト
   - 虹色スパークル

4. **CharacterCutin.tsx改修** - ズームイン＋震動演出
   - scale: 3 からのズームイン
   - 画面揺れ（SSRは激しく）
   - スピードライン（SSR）
   - レアリティ別のアクセントカラー

5. **SerifDisplay.tsx改修** - 位置を画面下部に
   - `fixed bottom-8`で下部固定
   - 装飾コーナー追加
   - バックドロップブラー

6. **RainbowEffect.tsx強化** - SSR演出強化
   - 画面揺れ
   - 金色のビネット
   - 虹色の回転ボーダー
   - 30個のアニメーションパーティクル
   - 16本の光線（2方向回転）
   - 8個の浮遊オーブ
   - 4コーナーのフレア

### 演出タイミング

```typescript
const PHASE_TIMINGS = {
  idle: 0,
  shatter: 600,      // クリスタル破砕
  flash: 150,        // フラッシュ
  rolling: 600,      // ローリング
  ssrExplosion: 800, // SSR専用爆発（SSRのみ）
  effect: 1200,      // 背景エフェクト
  rarity: 300,       // レアリティバッジ
  cutin: 800,        // 名前カットイン
  serif: 2500,       // セリフ表示
  fadeout: 500,      // フェードアウト
};
```
