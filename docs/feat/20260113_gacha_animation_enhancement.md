# ガチャ演出強化 設計書

## 概要

召喚演出を大幅に改修し、より豪華でゲームらしい体験を提供する。

## 実装完了 (2026-01-13)

全ての改修が完了し、ビルドも成功。

---

## 演出フロー（最終版）

```
[待機状態]
  扉＋クリスタル表示（脈動アニメーション）
       ↓ タップ
[破砕フェーズ] 500ms
  クリスタル発光 → 破砕 → 光の粒子飛散
  ※背景エフェクト開始（扉が開く時から）
       ↓
[フラッシュ] 150ms（SSR: 250ms 虹色グラデーション）
       ↓
[SSR爆発] 800ms（SSRのみ）
  画面揺れ・金色オーラ・50個以上のパーティクル
       ↓
[エフェクト] 600ms
  レアリティに応じた背景エフェクト
       ↓
[セリフ] 900ms × セリフ数 + 300ms
  中央にカットイン表示
  SE再生（各セリフ登場時）
  ※表示後も残る
       ↓
[レアリティ] 1000ms
  バッジ表示
  ※表示後も残る
       ↓
[名前ドカン！] 1200ms
  ズームイン＋震動
  SE再生
       ↓
[フェードアウト] 500ms
```

## 演出タイミング（実装値）

```typescript
const BASE_PHASE_TIMINGS = {
  idle: 0,
  shatter: 500,      // クリスタル破砕
  flash: 150,        // フラッシュ（SSR: 250ms）
  ssrExplosion: 800, // SSR専用爆発（SSRのみ）
  effect: 600,       // 背景エフェクト
  rarity: 1000,      // レアリティバッジ
  name: 1200,        // 名前ドカン表示
  fadeout: 500,
};

// セリフ表示
const SERIF_TIME_PER_LINE = 900;  // 各セリフ 900ms
const SERIF_BUFFER = 300;          // 余裕 300ms
```

## 実装内容

### 1. SummonGate.tsx - 召喚扉
- 両開きの豪華な金色の扉
- 中央に脈動するクリスタル
- 周囲にスパークルエフェクト
- 浮遊するパーティクル

### 2. CrystalShatter.tsx - クリスタル破砕
- レアリティに応じた色の破片
- 中央からのフラッシュ
- リングウェーブエフェクト
- SSR時は虹色バースト追加

### 3. SSRExplosion.tsx - SSR専用爆発
- 複数回のフラッシュ
- 画面揺れ
- 金色オーラ
- 50個以上のパーティクル
- スターバースト
- 虹色スパークル

### 4. RainbowEffect.tsx - 背景エフェクト
レアリティに応じて異なるエフェクト:
- **SSR**: 虹色ボーダー、金色ビネット、キラキラ、浮遊オーブ
- **SR**: 金色グラデーション、キラキラ
- **R**: 青色グラデーション、キラキラ
- **N**: 白色グラデーション

※回転する光線（顔を隠す）は削除済み

### 5. SerifDisplay.tsx - セリフ表示
- **位置**: 画面中央
- **背景**: `bg-black/95`（濃い黒で視認性向上）
- **文字**: 黒縁取り + グロー効果
- **SE**: 各セリフ登場時に`serifAppear`音を再生
- **アニメーション**: 左右交互にスライドイン
- **特徴**: 一度表示されたら消えない（積み重なる）

### 6. RarityBadge.tsx - レアリティバッジ
- 画面上部に表示
- レアリティごとの色分け
- 一度表示されたら消えない

### 7. NameReveal.tsx - 名前ドカン表示
- scale: 3 からのズームイン
- 画面揺れ（SSRは激しく）
- スピードライン（SSR）
- レアリティ別のアクセントカラー

### 8. GachaOverlay.tsx - 演出制御
- 全体のフェーズ管理
- SSR用虹色フラッシュ
- セリフ・レアリティ・名前が重なって表示される仕組み

## サウンド

| キー | 用途 | 音量 |
|------|------|------|
| gachaRoll | ガチャ開始時 | 0.5 |
| ssrGet | SSR確定時 | 0.7 |
| srGet | SR確定時 | 0.7 |
| rGet | R確定時 | 0.7 |
| nGet | N確定時 | 0.7 |
| cutin | 名前表示時 | 0.7 |
| serifAppear | セリフ登場時 | 0.4 |

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| src/components/Gacha/GachaOverlay.tsx | 演出オーケストレーション |
| src/components/Gacha/SummonGate.tsx | 扉＋クリスタル表示 |
| src/components/Gacha/CrystalShatter.tsx | 破砕エフェクト |
| src/components/Gacha/SSRExplosion.tsx | SSR専用エフェクト |
| src/components/Gacha/RainbowEffect.tsx | 背景エフェクト |
| src/components/Gacha/SerifDisplay.tsx | セリフ表示 |
| src/components/Gacha/RarityBadge.tsx | レアリティバッジ |
| src/components/Gacha/NameReveal.tsx | 名前ドカン表示 |
| src/lib/sounds.ts | サウンドマネージャー |

## 改善履歴

### 2026-01-13 初回実装
- 召喚扉・クリスタル破砕・SSR爆発を追加
- 名前ドカン演出を実装
- セリフ表示位置を調整

### 2026-01-13 演出チューニング
- セリフ表示までの時間を短縮（rolling削除、effect短縮）
- セリフ・レアリティ・名前が一度表示されたら消えないように
- セリフ位置を画面中央に変更
- 虹色くるくる演出を削除（顔が見えるように）
- SSRフラッシュを虹色グラデーションに
- セリフ登場SEを追加
- セリフの視認性向上（背景暗く、文字縁取り）

## 検証方法

1. `npm run dev` で開発サーバー起動
2. 各レアリティ（N/R/SR/SSR）で演出を確認
3. 特にSSRの演出が十分にド派手か確認
4. セリフが顔を隠さないか確認
5. `npm run build` でビルドエラーがないか確認
